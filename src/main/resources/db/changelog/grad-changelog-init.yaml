databaseChangeLog:
  - changeSet:
      id: 001-create-users-table
      author: antigravity
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: email
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: full_name
                  type: VARCHAR(255)
              - column:
                  name: phone
                  type: VARCHAR(20)
              - column:
                  name: avatar_url
                  type: VARCHAR(500)
              - column:
                  name: role
                  type: VARCHAR(50)
              - column:
                  name: status
                  type: VARCHAR(50)
              - column:
                  name: firebase_uid
                  type: VARCHAR(255)
                  constraints:
                    unique: true
              - column:
                  name: created_at
                  type: TIMESTAMP(6)
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP(6)

  - changeSet:
      id: 002-create-categories-table
      author: antigravity
      changes:
        - createTable:
            tableName: categories
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: VARCHAR(500)
              - column:
                  name: image_url
                  type: VARCHAR(500)
              - column:
                  name: parent_id
                  type: UUID
        - addForeignKeyConstraint:
            baseTableName: categories
            baseColumnNames: parent_id
            referencedTableName: categories
            referencedColumnNames: id
            constraintName: fk_categories_parent

  - changeSet:
      id: 003-create-products-table
      author: antigravity
      changes:
        - createTable:
            tableName: products
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: category_id
                  type: UUID
              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: price
                  type: DECIMAL(19, 2)
                  constraints:
                    nullable: false
              - column:
                  name: cost_price
                  type: DECIMAL(19, 2)
              - column:
                  name: thumbnail_url
                  type: VARCHAR(500)
              - column:
                  name: status
                  type: VARCHAR(50)
              - column:
                  name: average_rating
                  type: FLOAT8
              - column:
                  name: review_count
                  type: INT
              - column:
                  name: created_at
                  type: TIMESTAMP(6)
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP(6)
        - addForeignKeyConstraint:
            baseTableName: products
            baseColumnNames: category_id
            referencedTableName: categories
            referencedColumnNames: id
            constraintName: fk_products_category

  - changeSet:
      id: 004-create-branches-table
      author: antigravity
      changes:
        - createTable:
            tableName: branches
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: address
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: phone
                  type: VARCHAR(20)
              - column:
                  name: latitude
                  type: FLOAT8
              - column:
                  name: longitude
                  type: FLOAT8
              - column:
                  name: opening_hours
                  type: VARCHAR(255)
              - column:
                  name: status
                  type: VARCHAR(50)

  - changeSet:
      id: 005-create-inventory-table
      author: antigravity
      changes:
        - createTable:
            tableName: inventory
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: branch_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: product_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: quantity
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: min_stock
                  type: INT
              - column:
                  name: reserved_quantity
                  type: INT
        - addForeignKeyConstraint:
            baseTableName: inventory
            baseColumnNames: branch_id
            referencedTableName: branches
            referencedColumnNames: id
            constraintName: fk_inventory_branch
        - addForeignKeyConstraint:
            baseTableName: inventory
            baseColumnNames: product_id
            referencedTableName: products
            referencedColumnNames: id
            constraintName: fk_inventory_product

  - changeSet:
      id: 006-create-addresses-table
      author: antigravity
      changes:
        - createTable:
            tableName: addresses
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: receiver_name
                  type: VARCHAR(255)
              - column:
                  name: phone
                  type: VARCHAR(20)
              - column:
                  name: detail_address
                  type: VARCHAR(500)
              - column:
                  name: ward
                  type: VARCHAR(100)
              - column:
                  name: district
                  type: VARCHAR(100)
              - column:
                  name: city
                  type: VARCHAR(100)
              - column:
                  name: is_default
                  type: BOOLEAN
        - addForeignKeyConstraint:
            baseTableName: addresses
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_addresses_user

  - changeSet:
      id: 007-create-promotions-table
      author: antigravity
      changes:
        - createTable:
            tableName: promotions
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: code
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: type
                  type: VARCHAR(50)
              - column:
                  name: value
                  type: DECIMAL(19, 2)
              - column:
                  name: max_discount_amount
                  type: DECIMAL(19, 2)
              - column:
                  name: min_order_value
                  type: DECIMAL(19, 2)
              - column:
                  name: start_date
                  type: TIMESTAMP(6)
              - column:
                  name: end_date
                  type: TIMESTAMP(6)
              - column:
                  name: quantity_limit
                  type: INT
              - column:
                  name: usage_count
                  type: INT
              - column:
                  name: status
                  type: VARCHAR(50)

  - changeSet:
      id: 008-create-promotion-collections
      author: antigravity
      changes:
        - createTable:
            tableName: promotion_applicable_categories
            columns:
              - column:
                  name: promotion_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: applicable_category_ids
                  type: UUID
        - addForeignKeyConstraint:
            baseTableName: promotion_applicable_categories
            baseColumnNames: promotion_id
            referencedTableName: promotions
            referencedColumnNames: id
            constraintName: fk_promo_cat_promo
        - createTable:
            tableName: promotion_applicable_products
            columns:
              - column:
                  name: promotion_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: applicable_product_ids
                  type: UUID
        - addForeignKeyConstraint:
            baseTableName: promotion_applicable_products
            baseColumnNames: promotion_id
            referencedTableName: promotions
            referencedColumnNames: id
            constraintName: fk_promo_prod_promo

  - changeSet:
      id: 009-create-orders-table
      author: antigravity
      changes:
        - createTable:
            tableName: orders
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: promotion_id
                  type: UUID
              - column:
                  name: total_amount
                  type: DECIMAL(19, 2)
                  constraints:
                    nullable: false
              - column:
                  name: shipping_fee
                  type: DECIMAL(19, 2)
              - column:
                  name: discount_amount
                  type: DECIMAL(19, 2)
              - column:
                  name: final_amount
                  type: DECIMAL(19, 2)
                  constraints:
                    nullable: false
              - column:
                  name: payment_method
                  type: VARCHAR(50)
              - column:
                  name: status
                  type: VARCHAR(50)
              - column:
                  name: shipping_address
                  type: TEXT
              - column:
                  name: note
                  type: TEXT
              - column:
                  name: created_at
                  type: TIMESTAMP(6)
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP(6)
        - addForeignKeyConstraint:
            baseTableName: orders
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_orders_user
        - addForeignKeyConstraint:
            baseTableName: orders
            baseColumnNames: promotion_id
            referencedTableName: promotions
            referencedColumnNames: id
            constraintName: fk_orders_promotion

  - changeSet:
      id: 010-create-order-items-table
      author: antigravity
      changes:
        - createTable:
            tableName: order_items
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: order_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: product_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: quantity
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: price
                  type: DECIMAL(19, 2)
                  constraints:
                    nullable: false
              - column:
                  name: total_price
                  type: DECIMAL(19, 2)
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: order_items
            baseColumnNames: order_id
            referencedTableName: orders
            referencedColumnNames: id
            constraintName: fk_order_items_order
        - addForeignKeyConstraint:
            baseTableName: order_items
            baseColumnNames: product_id
            referencedTableName: products
            referencedColumnNames: id
            constraintName: fk_order_items_product

  - changeSet:
      id: 011-create-order-status-history-table
      author: antigravity
      changes:
        - createTable:
            tableName: order_status_history
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: order_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: status
                  type: VARCHAR(50)
              - column:
                  name: description
                  type: VARCHAR(500)
              - column:
                  name: created_at
                  type: TIMESTAMP(6)
                  constraints:
                    nullable: false
              - column:
                  name: created_by
                  type: VARCHAR(255)
        - addForeignKeyConstraint:
            baseTableName: order_status_history
            baseColumnNames: order_id
            referencedTableName: orders
            referencedColumnNames: id
            constraintName: fk_order_history_order

  - changeSet:
      id: 012-create-reviews-table
      author: antigravity
      changes:
        - createTable:
            tableName: reviews
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: product_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: rating
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: comment
                  type: TEXT
              - column:
                  name: created_at
                  type: TIMESTAMP(6)
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: reviews
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_reviews_user
        - addForeignKeyConstraint:
            baseTableName: reviews
            baseColumnNames: product_id
            referencedTableName: products
            referencedColumnNames: id
            constraintName: fk_reviews_product

  - changeSet:
      id: 013-create-review-images-table
      author: antigravity
      changes:
        - createTable:
            tableName: review_images
            columns:
              - column:
                  name: review_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: image_url
                  type: VARCHAR(500)
        - addForeignKeyConstraint:
            baseTableName: review_images
            baseColumnNames: review_id
            referencedTableName: reviews
            referencedColumnNames: id
            constraintName: fk_review_images_review

  - changeSet:
      id: 014-create-notifications-table
      author: antigravity
      changes:
        - createTable:
            tableName: notifications
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: type
                  type: VARCHAR(50)
              - column:
                  name: title
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: body
                  type: TEXT
                  constraints:
                    nullable: false
              - column:
                  name: target_url
                  type: VARCHAR(500)
              - column:
                  name: is_read
                  type: BOOLEAN
                  defaultValueBoolean: false
              - column:
                  name: created_at
                  type: TIMESTAMP(6)
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: notifications
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_notifications_user

  - changeSet:
      id: 015-create-product-images-table
      author: antigravity
      changes:
        - createTable:
            tableName: product_images
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: product_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: image_url
                  type: VARCHAR(500)
                  constraints:
                    nullable: false
              - column:
                  name: display_order
                  type: INT
        - addForeignKeyConstraint:
            baseTableName: product_images
            baseColumnNames: product_id
            referencedTableName: products
            referencedColumnNames: id
            constraintName: fk_product_images_product

  - changeSet:
      id: 016-create-product-specifications-table
      author: antigravity
      changes:
        - createTable:
            tableName: product_specifications
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
              - column:
                  name: product_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: spec_key
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: spec_value
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: product_specifications
            baseColumnNames: product_id
            referencedTableName: products
            referencedColumnNames: id
            constraintName: fk_product_specs_product
